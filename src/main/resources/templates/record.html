<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>PoliSight - ì‹œë®¬ë ˆì´ì…˜ ê¸°ë¡</title>

    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: { extend: { colors: { slate: { 900: '#070F22', 800: '#162133', 700: '#2B394D', 600: '#3F4D61', 500: '#57677E', 400: '#8796AB' } } } }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }
        .hidden { display: none; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .prose strong { color: #1e293b; font-weight: 700; }
        .prose p { margin-bottom: 0.8em; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen">

<th:block th:replace="~{HF :: header('record')}"></th:block>

<main class="flex-grow w-full max-w-5xl mx-auto px-4 py-12">

    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-8">
        <div>
            <h2 class="text-3xl font-bold text-slate-900 mb-2">ì‹œë®¬ë ˆì´ì…˜ ê¸°ë¡ ë³´ê´€ì†Œ</h2>
            <p class="text-slate-500">ì§€ê¸ˆê¹Œì§€ ì§„í–‰í•œ AI ì •ì±… ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”.</p>
        </div>
        <div class="px-5 py-3 bg-white rounded-xl border border-slate-200 shadow-sm flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center"><i class="fa-solid fa-file-invoice"></i></div>
            <div>
                <p class="text-xs text-slate-400 font-bold uppercase">ì €ì¥ëœ ê¸°ë¡</p>
                <p class="text-lg font-bold text-slate-800" th:text="${totalCount} + 'ê±´'">0ê±´</p>
            </div>
        </div>
    </div>

    <div class="flex justify-between items-center mb-6">
        <form action="/record" method="get" class="relative">
            <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
            <input type="text" name="keyword" th:value="${param.keyword}" placeholder="ì •ì±…ëª… ê²€ìƒ‰..." class="pl-9 pr-4 py-2 rounded-lg border border-slate-200 text-sm focus:outline-none focus:border-blue-500 w-64 bg-white">
        </form>
        <div class="flex gap-2">
            <button onclick="selectAll()" type="button" class="px-3 py-1.5 border border-slate-200 bg-white rounded-lg text-xs font-bold text-slate-600 hover:bg-slate-50 transition flex items-center gap-1">ì „ì²´ì„ íƒ</button>
            <button onclick="deselectAll()" type="button" class="px-3 py-1.5 border border-slate-200 bg-white rounded-lg text-xs font-bold text-slate-600 hover:bg-slate-50 transition flex items-center gap-1">ì„ íƒí•´ì œ</button>
            <button onclick="openDeleteModal()" type="button" class="px-3 py-1.5 bg-slate-100 text-slate-600 rounded-lg text-xs font-bold hover:bg-red-50 hover:text-red-500 transition flex items-center gap-1">ì‚­ì œ</button>
        </div>
    </div>

    <div class="space-y-4">
        <div th:if="${recordList == null or #lists.isEmpty(recordList)}" class="text-center py-12 bg-white rounded-2xl border border-slate-200 border-dashed">
            <p class="text-slate-400">ì €ì¥ëœ ì‹œë®¬ë ˆì´ì…˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>

        <div th:each="record : ${recordList}"
             class="group bg-white rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-all relative overflow-hidden flex items-stretch">

            <div class="absolute top-0 left-0 w-1.5 h-full" th:classappend="${record.suitability == 'Y'} ? 'bg-blue-500' : 'bg-red-400'"></div>

            <div class="flex items-center pl-5">
                <input type="checkbox" name="recordChk" th:value="${record.simIdx}" class="w-5 h-5 rounded border-slate-300 text-blue-600 cursor-pointer">
            </div>

            <div class="flex-1 p-6 flex flex-col md:flex-row justify-between gap-6">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded" th:text="${#temporals.format(record.createdAt, 'yyyy.MM.dd')}">2026.01.23</span>

                        <span th:if="${record.suitability == 'Y'}" class="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded border border-blue-100">ì¡°ê±´ ì¶©ì¡±</span>
                        <span th:unless="${record.suitability == 'Y'}" class="text-xs font-bold text-red-600 bg-red-50 px-2 py-0.5 rounded border border-red-100">ì¡°ê±´ ë¶ˆì¶©ì¡±</span>
                    </div>

                    <h3 class="text-xl font-bold text-slate-800 mb-2 group-hover:text-blue-600 transition" th:text="${record.policyName}">ì •ì±… ì´ë¦„</h3>
                    <p class="text-sm text-slate-500 mb-4 line-clamp-1" th:text="${record.policyIntro}">ì •ì±… ì†Œê°œ</p>

                    <div class="flex items-center gap-6 text-sm text-slate-600">
                        <div class="flex items-center gap-1.5"><i class="fa-solid fa-location-dot text-slate-400"></i><span th:text="${record.regionText}">ì§€ì—­</span></div>
                        <div class="flex items-center gap-1.5"><i class="fa-solid fa-user text-slate-400"></i><span th:text="|ë§Œ ${record.userAge}ì„¸ / ${record.jobName}|">ë‚˜ì´/ì§ì—…</span></div>
                    </div>
                </div>

                <div class="flex md:flex-col justify-end gap-2 min-w-[120px]">
                    <button type="button"
                            th:data-title="${record.policyName}"
                            th:data-desc="${record.policyIntro}"
                            th:data-content="${record.content}"
                            th:data-suitability="${record.suitability}"
                            th:data-gender="${record.gender}"
                            th:data-age="${record.userAge}"
                            th:data-region="${record.regionText}"
                            th:data-edu="${record.eduLevelCode}"
                            th:data-emp="${record.empStatusCode}"
                            th:data-marry="${record.married}"
                            th:data-family="${record.familySize}"
                            th:data-child="${record.child}"
                            th:data-p-income="${record.personalIncome}"
                            th:data-f-income="${record.familyIncome}"
                            th:data-prompt="${record.prompt}"
                            onclick="openDetailModal(this)"
                            class="w-full px-4 py-2.5 bg-slate-900 text-white text-sm font-bold rounded-xl hover:bg-black transition flex items-center justify-center gap-2 shadow-md">
                        <span>ê²°ê³¼ ë‹¤ì‹œë³´ê¸°</span>
                        <i class="fa-solid fa-chevron-right text-xs"></i>
                    </button>
                    <button type="button" th:onclick="|deleteSingle(${record.simIdx})|" class="w-full px-4 py-2.5 bg-white border border-slate-200 text-slate-500 text-sm font-bold rounded-xl hover:bg-red-50 hover:text-red-500 transition">ì‚­ì œ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="flex justify-center mt-12" th:if="${totalPages > 0}">
        <nav class="flex gap-1">
            <a th:href="@{/record(page=${currentPage - 1}, keyword=${param.keyword})}" th:classappend="${currentPage == 1} ? 'pointer-events-none opacity-50' : ''" class="w-10 h-10 flex items-center justify-center rounded-lg border border-slate-200 bg-white text-slate-500"><i class="fa-solid fa-chevron-left text-xs"></i></a>
            <th:block th:each="page : ${#numbers.sequence(startPage, endPage)}">
                <a th:href="@{/record(page=${page}, keyword=${param.keyword})}" th:text="${page}" th:classappend="${page == currentPage} ? 'border-slate-900 bg-slate-900 text-white' : 'border-slate-200 bg-white text-slate-600'" class="w-10 h-10 flex items-center justify-center rounded-lg border font-bold transition">1</a>
            </th:block>
            <a th:href="@{/record(page=${currentPage + 1}, keyword=${param.keyword})}" th:classappend="${currentPage == totalPages} ? 'pointer-events-none opacity-50' : ''" class="w-10 h-10 flex items-center justify-center rounded-lg border border-slate-200 bg-white text-slate-500"><i class="fa-solid fa-chevron-right text-xs"></i></a>
        </nav>
    </div>
</main>

<th:block th:replace="~{HF :: footer}"></th:block>
<div th:replace="~{chatbot :: chatbot}"></div>

<div id="detail-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center" role="dialog" aria-modal="true">
    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeDetailModal()"></div>
    <div class="relative bg-white w-full max-w-7xl h-[90vh] rounded-2xl shadow-2xl overflow-hidden flex flex-col transform transition-all">

        <div class="px-8 py-6 border-b border-slate-100 flex-shrink-0 bg-white z-10 flex justify-between items-center">
            <div>
                <h2 class="text-2xl font-bold text-slate-900">ì‹œë®¬ë ˆì´ì…˜ ë¶„ì„ ê²°ê³¼</h2>
            </div>
            <button onclick="closeDetailModal()" class="text-slate-400 hover:text-slate-700 transition p-2 rounded-full hover:bg-slate-100"><i class="fa-solid fa-xmark text-2xl"></i></button>
        </div>

        <div class="flex-grow overflow-y-auto custom-scroll p-8 bg-slate-50">
            <div class="grid lg:grid-cols-12 gap-8">

                <aside class="lg:col-span-4 space-y-6">
                    <div class="bg-white rounded-2xl border border-blue-100 shadow-lg shadow-blue-50/50 p-6 relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-24 h-24 bg-blue-50 rounded-bl-full -mr-4 -mt-4 z-0"></div>
                        <div class="relative z-10">
                            <div class="flex items-center gap-2 text-sm text-blue-600 font-bold mb-4">
                                <i class="fa-solid fa-crosshairs"></i> ë¶„ì„ ëŒ€ìƒ ì •ì±…
                            </div>
                            <div class="mb-5">
                                <h4 id="modal-policy-name" class="font-bold text-xl text-slate-900 leading-tight">-</h4>
                            </div>
                            <div class="space-y-4 text-sm text-slate-600 border-t border-slate-100 pt-4">
                                <div class="flex flex-col gap-1.5">
                                    <span class="text-slate-400 text-xs font-bold">ì§€ì› ë‚´ìš©</span>
                                    <p id="modal-policy-desc" class="font-medium text-slate-700 leading-relaxed line-clamp-4 break-keep">-</p>
                                </div>
                                <div class="flex justify-between items-center pt-2 border-t border-slate-50">
                                    <span class="text-slate-400 text-xs">ìƒì„¸ ì •ë³´</span>
                                    <span class="font-bold text-slate-700">í™ˆí˜ì´ì§€ ì°¸ì¡°</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wide">ë¶„ì„ ì¡°ê±´</h3>
                        </div>
                        <div class="space-y-6 divide-y divide-slate-100">
                            <div class="pt-0">
                                <h4 class="text-xs font-bold text-slate-400 mb-3">ê¸°ë³¸ ì¸ì  ì‚¬í•­</h4>
                                <ul class="space-y-2">
                                    <li class="flex justify-between text-sm"><span class="text-slate-500">ì„±ë³„</span><span id="cond-gender" class="font-bold text-slate-800">-</span></li>
                                    <li class="flex justify-between text-sm"><span class="text-slate-500">ë‚˜ì´</span><span id="cond-age" class="font-bold text-blue-600">-</span></li>
                                    <li class="flex justify-between text-sm"><span class="text-slate-500">ê±°ì£¼ì§€</span><span id="cond-region" class="font-bold text-slate-800">-</span></li>
                                </ul>
                            </div>
                            <div class="pt-4">
                                <h4 class="text-xs font-bold text-slate-400 mb-3">ì‚¬íšŒì  ìƒíƒœ</h4>
                                <ul class="space-y-2">
                                    <li class="flex justify-between text-sm"><span class="text-slate-500">í•™ë ¥</span><span id="cond-edu" class="font-bold text-slate-800">-</span></li>
                                    <li class="flex justify-between text-sm"><span class="text-slate-500">ê³ ìš©</span><span id="cond-emp" class="font-bold text-blue-600">-</span></li>
                                </ul>
                            </div>
                            <div class="pt-4">
                                <h4 class="text-xs font-bold text-slate-400 mb-3">ê°€êµ¬ ë° ì£¼ê±°</h4>
                                <ul class="space-y-2">
                                    <li class="flex justify-between text-sm"><span class="text-slate-500">ê²°í˜¼</span><span id="cond-marry" class="font-bold text-slate-800">-</span></li>
                                    <li class="flex justify-between text-sm"><span class="text-slate-500">ê°€êµ¬ì›</span><span id="cond-family" class="font-bold text-slate-800">-</span></li>
                                    <li class="flex justify-between text-sm"><span class="text-slate-500">ìë…€</span><span id="cond-child" class="font-bold text-slate-800">-</span></li>
                                </ul>
                            </div>
                            <div class="pt-4">
                                <h4 class="text-xs font-bold text-slate-400 mb-3">ê²½ì œ ìƒí™©</h4>
                                <ul class="space-y-2">
                                    <li class="flex justify-between text-sm"><span class="text-slate-500">ë³¸ì¸ì†Œë“</span><span id="cond-p-income" class="font-bold text-slate-800">-</span></li>
                                    <li class="flex justify-between text-sm"><span class="text-slate-500">ê°€êµ¬ì†Œë“</span><span id="cond-f-income" class="font-bold text-slate-800">-</span></li>
                                </ul>
                            </div>
                            <div class="pt-6 mt-2 border-t border-slate-50">
                                <h4 class="font-bold text-sm text-slate-800 mb-3 flex items-center gap-2"><span class="w-2.5 h-2.5 bg-indigo-600 rounded-full"></span> AI ì •ë°€ ë¶„ì„ ìš”ì²­ì‚¬í•­</h4>
                                <div class="bg-indigo-50/60 rounded-xl p-3 border border-indigo-100 min-h-[60px]">
                                    <p id="cond-prompt" class="text-sm text-indigo-900 leading-relaxed font-medium break-keep">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>

                <section class="lg:col-span-8 space-y-8">
                    <div id="modal-result-card" class="rounded-2xl border shadow-lg overflow-hidden transition-all duration-500">
                        <div id="modal-header-bg" class="p-8 text-white relative overflow-hidden">
                            <div class="absolute right-0 top-0 w-64 h-64 bg-white/10 rounded-full -mr-16 -mt-16 blur-3xl"></div>
                            <div class="relative z-10 flex items-center justify-between">
                                <div>
                                    <div class="flex items-center gap-2 mb-2 opacity-90 text-sm font-medium">AI Policy Analyst</div>
                                    <h2 id="modal-suitability-text" class="text-3xl font-bold leading-normal">-</h2>
                                </div>
                                <div id="modal-status-badge" class="bg-white/20 px-4 py-2 rounded-full text-lg font-bold border border-white/30 backdrop-blur-sm">-</div>
                            </div>
                        </div>
                        <div class="p-8 bg-white">
                            <h3 class="text-lg font-bold text-slate-800 mb-3 flex items-center gap-2"><i id="modal-quote-icon" class="fa-solid fa-quote-left"></i> AI ìƒë‹´ì‚¬ì˜ ë§ì¶¤í˜• ê°€ì´ë“œ</h3>
                            <div id="modal-ai-guide" class="bg-slate-50 rounded-xl p-6 border border-slate-200 text-slate-700 leading-relaxed text-sm shadow-inner prose prose-sm max-w-none">
                                <div class="flex flex-col items-center justify-center py-10 text-slate-400"><i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i><span>ë°ì´í„° ë¡œë”© ì¤‘...</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-6">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><div class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center text-purple-600 text-sm"><i class="fa-solid fa-arrow-trend-up"></i></div>ë¯¸ë˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œë‚˜ë¦¬ì˜¤</h3>
                        <div id="modal-scenarios" class="space-y-3"></div>
                    </div>

                    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-6">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><div class="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center text-blue-600 text-sm"><i class="fa-solid fa-thumbs-up"></i></div>ì¶”ì²œ ë° ê´€ë ¨ ì •ì±…</h3>
                        <div class="bg-slate-50 rounded-xl p-5 border border-slate-200 shadow-inner"><ul id="modal-recommendations" class="space-y-3"></ul></div>
                    </div>

                    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-6">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><div class="w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center text-slate-600 text-sm"><i class="fa-solid fa-scale-balanced"></i></div>AI ë¶„ì„ ê·¼ê±° ë°ì´í„°</h3>
                        <div id="modal-evidence" class="space-y-3"></div>
                    </div>
                </section>
            </div>
        </div>
        <div class="border-t border-slate-100 p-4 bg-white flex justify-end flex-shrink-0 z-10 min-h-[20px]">
        </div>
    </div>
</div>

<div id="policy-modal" class="fixed inset-0 z-[150] hidden flex items-center justify-center" role="dialog" aria-modal="true">
    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeDetail()"></div>
    <div class="relative bg-white w-full max-w-5xl h-[85vh] rounded-2xl shadow-2xl overflow-hidden flex flex-col transform transition-all">
        <div class="px-8 py-6 border-b border-slate-100 flex-shrink-0 bg-white z-10 flex justify-between items-start">
            <div class="pr-10">
                <h2 id="modal-title" class="text-2xl md:text-3xl font-extrabold text-slate-900 tracking-tight leading-snug break-keep">ì •ì±… ì œëª©</h2>
                <p id="modal-keywords" class="text-sm text-slate-500 font-medium mt-2">#í‚¤ì›Œë“œ</p>
            </div>
            <button onclick="closeDetail()" class="text-slate-400 hover:text-slate-700 transition p-2 rounded-full hover:bg-slate-100">
                <i class="fa-solid fa-xmark text-2xl"></i>
            </button>
        </div>
        <div class="flex-grow overflow-y-auto custom-scroll p-6 md:p-8 bg-white">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-8 space-y-10">
                    <section>
                        <h4 class="flex items-center text-lg font-bold text-slate-800 mb-3">
                            <span class="w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center mr-2 text-sm"><i class="fa-solid fa-circle-info"></i></span>ì •ì±… ì„¤ëª…
                        </h4>
                        <div id="modal-desc-original" class="bg-slate-50 p-6 rounded-2xl text-[15px] leading-relaxed text-slate-700 border border-slate-200 whitespace-pre-wrap"></div>
                        <div id="modal-desc-easy" class="hidden bg-yellow-50 p-6 rounded-2xl text-[15px] leading-relaxed text-slate-700 border border-yellow-100">(ì‰¬ìš´ ë§) ì•„ì§ ë³€í™˜ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                    </section>
                    <section>
                        <h4 class="flex items-center text-lg font-bold text-slate-800 mb-3">
                            <span class="w-8 h-8 rounded-lg bg-pink-100 text-pink-500 flex items-center justify-center mr-2 text-sm"><i class="fa-solid fa-gift"></i></span>ì§€ì› ë‚´ìš©
                        </h4>
                        <div id="modal-support" class="bg-slate-50 p-6 rounded-2xl text-[15px] leading-relaxed text-slate-700 border border-slate-200 whitespace-pre-wrap"></div>
                    </section>
                    <section>
                        <h4 class="flex items-center text-lg font-bold text-slate-800 mb-3">
                            <span class="w-8 h-8 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center mr-2 text-sm"><i class="fa-solid fa-file-invoice"></i></span>ì‹ ì²­ ì ˆì°¨ ë° ì„œë¥˜
                        </h4>
                        <div id="modal-documents" class="bg-slate-50 p-6 rounded-2xl text-[15px] leading-relaxed text-slate-700 border border-slate-200 whitespace-pre-wrap"></div>
                    </section>
                    <section>
                        <h4 class="flex items-center text-sm font-bold text-slate-500 mb-2"><i class="fa-solid fa-circle-exclamation mr-2"></i>ê¸°íƒ€ ìœ ì˜ì‚¬í•­</h4>
                        <p id="modal-etc" class="text-xs text-slate-400 leading-5"></p>
                    </section>
                </div>
                <div class="lg:col-span-4 space-y-5">
                    <div class="bg-blue-50/50 border border-blue-100 rounded-2xl p-5">
                        <h5 class="text-blue-800 font-bold text-sm mb-4 flex items-center"><i class="fa-regular fa-calendar-check mr-2"></i>ì‹ ì²­ ë° ì‚¬ì—… ê¸°ê°„</h5>
                        <div class="space-y-3">
                            <div><p class="text-xs text-slate-500 mb-1">ì‹ ì²­ ê¸°ê°„</p><p id="modal-apply-prd" class="text-slate-800 font-bold text-sm"></p></div>
                            <div class="w-full h-px bg-blue-100"></div>
                            <div><p class="text-xs text-slate-500 mb-1">ì‚¬ì—… ìš´ì˜ ê¸°ê°„</p><p id="modal-biz-prd" class="text-slate-800 font-medium text-sm"></p></div>
                        </div>
                    </div>
                    <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm">
                        <h5 class="text-slate-800 font-bold text-sm mb-4 flex items-center"><i class="fa-solid fa-user-check mr-2 text-slate-400"></i>ì‹ ì²­ ìê²© ìš”ê±´</h5>
                        <ul class="space-y-4 text-sm">
                            <li class="flex justify-between items-start"><span class="text-slate-700 font-bold flex-shrink-0">ë‚˜ì´</span><span id="modal-age" class="font-medium text-slate-600 text-right"></span></li>
                            <li class="flex justify-between items-start"><span class="text-slate-700 font-bold flex-shrink-0">ì†Œë“</span><div class="text-right"><span id="modal-income" class="font-medium text-slate-600 block"></span><span id="modal-earn-etc" class="text-[10px] text-slate-400 block mt-0.5"></span></div></li>
                            <li class="flex justify-between items-start"><span class="text-slate-700 font-bold flex-shrink-0">ê±°ì£¼ì§€</span><span id="modal-zip" class="font-medium text-slate-600 text-right"></span></li>
                            <li class="flex justify-between items-start"><span class="text-slate-700 font-bold flex-shrink-0">í•™ë ¥</span><span id="modal-school" class="font-medium text-slate-600 text-right"></span></li>
                            <li class="flex justify-between items-start"><span class="text-slate-700 font-bold flex-shrink-0">ì „ê³µ</span><span id="modal-major" class="font-medium text-slate-600 text-right"></span></li>
                            <li class="flex justify-between items-start"><span class="text-slate-700 font-bold flex-shrink-0">ì·¨ì—…ìƒíƒœ</span><span id="modal-job" class="font-medium text-slate-600 text-right"></span></li>
                        </ul>
                    </div>
                    <div class="pt-2">
                        <a id="modal-ref1-url" href="#" target="_blank" class="block w-full text-center py-2 text-xs text-slate-900 hover:text-blue-600 hover:underline transition"><i class="fa-solid fa-link mr-1"></i> ì°¸ê³  ì‚¬ì´íŠ¸ ë°”ë¡œê°€ê¸° 1</a>
                        <a id="modal-ref2-url" href="#" target="_blank" class="block w-full text-center py-1 text-xs text-slate-900 hover:text-blue-600 hover:underline transition"><i class="fa-solid fa-link mr-1"></i> ì°¸ê³  ì‚¬ì´íŠ¸ ë°”ë¡œê°€ê¸° 2</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="border-t border-slate-100 p-5 bg-white flex flex-col sm:flex-row gap-3 items-center justify-between flex-shrink-0 z-10">
            <button id="btn-easy-toggle" onclick="toggleEasyMode()" class="w-full sm:w-auto px-5 py-3 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 hover:border-slate-300 transition flex items-center justify-center gap-2 text-sm"><i class="fa-regular fa-face-smile"></i><span>ì‰¬ìš´ ë§ë¡œ ë³´ê¸°</span></button>
            <a id="modal-apply-url" href="#" target="_blank" class="w-full sm:flex-1 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-200 text-center flex items-center justify-center gap-2 text-sm"><span>ì‹ ì²­ í™ˆí˜ì´ì§€ ë°”ë¡œê°€ê¸°</span><i class="fa-solid fa-arrow-up-right-from-square"></i></a>
        </div>
    </div>
</div>

<div id="delete-modal" class="fixed inset-0 z-[120] hidden flex items-center justify-center" aria-modal="true">
    <div class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity" onclick="closeDeleteModal()"></div>
    <div class="relative bg-white w-full max-w-sm rounded-2xl shadow-2xl p-6 text-center transform scale-95 opacity-0 transition-all duration-200" id="delete-content">
        <div class="w-12 h-12 rounded-full bg-red-100 text-red-500 flex items-center justify-center mx-auto mb-4 text-xl">
            <i class="fa-solid fa-trash-can"></i>
        </div>
        <h3 class="text-lg font-bold text-slate-900 mb-2">ê¸°ë¡ ì‚­ì œ</h3>
        <p class="text-sm text-slate-500 mb-6 leading-relaxed">ì„ íƒí•œ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>ì‚­ì œ í›„ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        <div class="flex gap-3">
            <button onclick="closeDeleteModal()" class="flex-1 py-3 border border-slate-200 bg-white text-slate-600 font-bold rounded-xl hover:bg-slate-50 transition text-sm">ì·¨ì†Œ</button>
            <button onclick="confirmDelete()" class="flex-1 py-3 bg-red-600 text-white font-bold rounded-xl hover:bg-red-700 transition text-sm shadow-md">ì‚­ì œ</button>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const eduMap = { 1: "ì¤‘ì¡¸ ì´í•˜", 2: "ê³ êµ ì¬í•™", 3: "ê³ ì¡¸ ì˜ˆì •", 4: "ê³ ì¡¸", 5: "ëŒ€í•™ ì¬í•™", 6: "ëŒ€ì¡¸ ì˜ˆì •", 7: "ëŒ€ì¡¸", 8: "ì„/ë°•ì‚¬", 0: "ì •ë³´ ì—†ìŒ" };
    const empMap = { "UNEMPLOYED": "ë¯¸ì·¨ì—…", "EMPLOYED": "ì¬ì§ì¤‘", "default": "ê¸°íƒ€" };

    // [ì¶”ê°€] result.htmlê³¼ ë™ì¼í•œ ë§¤í•‘ ë°ì´í„°
    const rawZipData = /*[[${regionMapping}]]*/ {} || {};
    const zipMap = Object.assign({ "NONE": "ì œí•œì—†ìŒ", "null": "ì œí•œì—†ìŒ" }, rawZipData);

    const majorMap = { "HUMANITIES": "ì¸ë¬¸ê³„ì—´", "SOCIAL": "ì‚¬íšŒê³„ì—´", "COMMERCE": "ìƒê²½ê³„ì—´", "SCIENCE": "ì´í•™ê³„ì—´", "ENGINEERING": "ê³µí•™ê³„ì—´", "ARTS_SPORTS": "ì˜ˆì²´ëŠ¥ê³„ì—´", "AGRICULTURE": "ë†ì‚°ì—…ê³„ì—´", "ETC": "ê¸°íƒ€", "NONE": "ì œí•œì—†ìŒ" };
    const schoolMap = { "UNDER_HIGH_SCHOOL": "ê³ ì¡¸ ë¯¸ë§Œ", "HIGH_SCHOOL_ATTENDING": "ê³ êµ ì¬í•™", "HIGH_SCHOOL_GRADUATING": "ê³ ì¡¸ ì˜ˆì •", "HIGH_SCHOOL_GRADUATE": "ê³ êµ ì¡¸ì—…", "UNIV_ATTENDING": "ëŒ€í•™ ì¬í•™", "UNIV_GRADUATING": "ëŒ€ì¡¸ ì˜ˆì •", "UNIV_GRADUATE": "ëŒ€í•™ ì¡¸ì—…", "MASTER_DOCTOR": "ì„Â·ë°•ì‚¬", "ETC": "ê¸°íƒ€", "NONE": "ì œí•œì—†ìŒ" };
    const jobMap = { "WORKER": "ì¬ì§ì", "SELF_EMPLOYED": "ìì˜ì—…ì", "UNEMPLOYED": "ë¯¸ì·¨ì—…ì", "FREELANCER": "í”„ë¦¬ëœì„œ", "DAILY_WORKER": "ì¼ìš©ê·¼ë¡œì", "ENTREPRENEUR": "(ì˜ˆë¹„)ì°½ì—…ì", "SHORT_TERM_WORKER": "ë‹¨ê¸°ê·¼ë¡œì", "FARMER": "ì˜ë†ì¢…ì‚¬ì", "ETC": "ê¸°íƒ€", "NONE": "ì œí•œì—†ìŒ" };
    const incomeMap = { "IRRELEVANT": "ë¬´ê´€", "ANNUAL_INCOME": "ì—°ì†Œë“", "ETC": "ê¸°íƒ€" };

    function selectAll() { document.querySelectorAll('input[name="recordChk"]').forEach(cb => cb.checked = true); }
    function deselectAll() { document.querySelectorAll('input[name="recordChk"]').forEach(cb => cb.checked = false); }
    function closeDetailModal() { document.getElementById('detail-modal').classList.add('hidden'); }

    // [ì¶”ê°€] ì •ì±… ìƒì„¸ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ (result.htmlê³¼ ë™ì¼)
    function formatDateStr(str) {
        if (!str) return str;
        return str.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3');
    }

    function cleanAndFormatText(text) {
        if (!text) return "";
        const lines = text.split('\n');
        const processed = lines.map(line => {
            let trimmed = line.trim();
            if (!trimmed) return "";
            const isIndented = /^\s+([-ã…‡â—‹â–¡ââ€¢Â·*]|\d+\.)/.test(line);
            let cleanContent = trimmed.replace(/^([-ã…‡â—‹â–¡ââ€¢Â·*]|\d+\.)\s*/, '').trim();
            if (!cleanContent) return line;
            if (isIndented) return `    - ${cleanContent}`;
            if (/^([-ã…‡â—‹â–¡ââ€¢Â·*]|\d+\.)/.test(trimmed)) return `â€¢ ${cleanContent}`;
            return line;
        });
        return processed.join('\n');
    }

    let easyMode = false;
    function closeDetail() {
        const modal = document.getElementById('policy-modal');
        if (modal) {
            modal.classList.remove('opacity-100');
            setTimeout(() => { modal.classList.add('hidden'); }, 200);
        }
    }

    function toggleEasyMode() {
        easyMode = !easyMode;
        document.getElementById('modal-desc-original').classList.toggle('hidden', easyMode);
        document.getElementById('modal-desc-easy').classList.toggle('hidden', !easyMode);
        document.getElementById('btn-easy-toggle').querySelector('span').innerText = easyMode ? "ì›ë¬¸ ë³´ê¸°" : "ì‰¬ìš´ ë§ë¡œ ë³´ê¸°";
    }

    // [ì¶”ê°€] ì¶”ì²œ ì •ì±… ìƒì„¸ë³´ê¸° í•¨ìˆ˜
    function openDetailById(plcyNo) {
        if (!plcyNo) {
            alert("í•´ë‹¹ ì •ì±…ì˜ ìƒì„¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        fetch(`/api/policy/${plcyNo}`)
            .then(res => res.json())
            .then(d => {
                const set = (id, val) => {
                    const el = document.getElementById(id);
                    if (el) el.innerText = (val && val !== 'null') ? val : 'ì •ë³´ ì—†ìŒ';
                };
                const parseArr = (data, mapObj) => {
                        if (!data || (Array.isArray(data) && data.length === 0) || data === 'null' || data === 'NONE') return 'ì œí•œ ì—†ìŒ';
                        const nationwideList = ["11110","11140","11170","11200","11215","11230","11260","11290","11305","11320","11350","11380","11410","11440","11470","11500","11530","11545","11560","11590","11620","11650","11680","11710","11740","26110","26140","26170","26200","26230","26260","26290","26320","26350","26380","26410","26440","26470","26500","26530","26710","27110","27140","27170","27200","27230","27260","27290","27710","27720","28110","28140","28177","28185","28200","28237","28245","28260","28710","28720","29110","29140","29155","29170","29200","30110","30140","30170","30200","30230","31110","31140","31170","31200","31710","36110","41111","41113","41115","41117","41131","41133","41135","41150","41171","41173","41192","41194","41196","41210","41220","41250","41271","41273","41281","41285","41287","41290","41310","41360","41370","41390","41410","41430","41450","41461","41463","41465","41480","41500","41550","41570","41590","41610","41630","41650","41670","41800","41820","41830","43111","43112","43113","43114","43130","43150","43720","43730","43740","43745","43750","43760","43770","43800","44131","44133","44150","44180","44200","44210","44230","44250","44270","44710","44760","44770","44790","44800","44810","44825","46110","46130","46150","46170","46230","46710","46720","46730","46770","46780","46790","46800","46810","46820","46830","46840","46860","46870","46880","46890","46900","46910","47111","47113","47130","47150","47170","47190","47210","47230","47250","47280","47290","47730","47750","47760","47770","47820","47830","47840","47850","47900","47920","47930","47940","48121","48123","48125","48127","48129","48170","48220","48240","48250","48270","48310","48330","48720","48730","48740","48820","48840","48850","48860","48870","48880","48890","50110","50130","51110","51130","51150","51170","51190","51210","51230","51720","51730","51750","51760","51770","51780","51790","51800","51810","51820","51830","52111","52113","52130","52140","52180","52190","52210","52710","52720","52730","52740","52750","52770","52790","52800"];
                        try {
                            if (Array.isArray(data)) {
                                if (data.length === nationwideList.length) {
                                    if (data.every(code => nationwideList.includes(String(code)))) return "ì „êµ­";
                                }
                                return data.map(item => { const key = String(item).trim(); return (mapObj && mapObj[key]) ? mapObj[key] : key; }).join(', ');
                            }
                            let parsed = (typeof data === 'string' && data.startsWith('[')) ? JSON.parse(data) : data;
                            if (Array.isArray(parsed)) {
                                if (parsed.length === nationwideList.length) {
                                    if (parsed.every(code => nationwideList.includes(String(code)))) return "ì „êµ­";
                                }
                                return parsed.map(item => (mapObj && mapObj[String(item).trim()]) ? mapObj[String(item).trim()] : item).join(', ');
                            }
                            return (mapObj && mapObj[data]) ? mapObj[data] : data;
                        } catch(e) { return (mapObj && mapObj[data]) ? mapObj[data] : data; }
                    };

                set('modal-title', d.plcyNm);

                let formattedKeywords = "";
                if (d.plcyKywdNm && d.plcyKywdNm !== 'null') {
                    formattedKeywords = d.plcyKywdNm.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0).map(tag => tag.startsWith('#') ? tag : '#' + tag).join(' ');
                }
                if(document.getElementById('modal-keywords')) document.getElementById('modal-keywords').innerText = formattedKeywords;

                set('modal-desc-original', cleanAndFormatText(d.plcyExplnCn));
                set('modal-support', cleanAndFormatText(d.plcySprtCn));
                set('modal-age', `ë§Œ ${d.sprtTrgtMinAge || 0}ì„¸ ~ ${d.sprtTrgtMaxAge || 99}ì„¸`);
                const incomeText = (d.earnCndSeCd === 'IRRELEVANT') ? 'ë¬´ê´€' : `[${parseArr(d.earnCndSeCd, incomeMap)}] ${d.earnMinAmt || 0}ë§Œì› ~ ${(!d.earnMaxAmt || d.earnMaxAmt === 0) ? 'ë¬´ì œí•œ' : d.earnMaxAmt + 'ë§Œì›'}`;
                set('modal-income', incomeText);
                set('modal-earn-etc', d.earnEtcCn);
                set('modal-zip', parseArr(d.zipCd, zipMap));
                set('modal-school', parseArr(d.schoolCd, schoolMap));
                set('modal-major', parseArr(d.plcyMajorCd, majorMap));
                set('modal-job', parseArr(d.jobCd, jobMap));
                set('modal-apply-prd', formatDateStr(d.aplyYmd));
                const bizDates = (d.bizPrdBgngYmd && d.bizPrdEndYmd) ? `${d.bizPrdBgngYmd} ~ ${d.bizPrdEndYmd}` : 'ì •ë³´ ì—†ìŒ';
                set('modal-biz-prd', bizDates);
                set('modal-documents', cleanAndFormatText(d.sbmsnDcmntCn));

                let etcText = d.etcMttrCn;
                if (!etcText || etcText === 'null' || etcText.trim() === '') {
                    etcText = "ì •ì±… ë‚´ìš©ì€ ì •ë¶€ ë° ì§€ìì²´ì˜ ì‚¬ì •ì— ë”°ë¼ ì‚¬ì „ ì˜ˆê³  ì—†ì´ ë³€ê²½ë˜ê±°ë‚˜ ì¢…ë£Œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                }
                if(document.getElementById('modal-etc')) document.getElementById('modal-etc').innerText = etcText;

                const setLink = (id, url) => {
                    const el = document.getElementById(id);
                    if(el) {
                        el.href = url || '#';
                        el.style.display = (url && url !== 'null' && url.trim() !== '') ? 'flex' : 'none';
                    }
                };
                setLink('modal-apply-url', d.aplyUrlAddr);
                setLink('modal-ref1-url', d.refUrlAddr1);
                setLink('modal-ref2-url', d.refUrlAddr2);

                const modal = document.getElementById('policy-modal');
                if (modal) {
                    modal.classList.remove('hidden');
                    setTimeout(() => modal.classList.add('opacity-100'), 10);
                }
            })
            .catch(err => console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", err));
    }

    function openDetailModal(btn) {
        document.getElementById('modal-policy-name').innerText = btn.getAttribute('data-title');
        const desc = btn.getAttribute('data-desc');
        document.getElementById('modal-policy-desc').innerText = (desc && desc !== 'null') ? desc : 'ì •ì±… ìƒì„¸ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.';

        const gender = btn.getAttribute('data-gender');
        if (!gender || gender === 'null') {
            document.getElementById('cond-gender').innerText = 'ì •ë³´ ì—†ìŒ';
        } else {
            document.getElementById('cond-gender').innerText = (gender === 'male' || gender === 'M') ? 'ë‚¨ì„±' : 'ì—¬ì„±';
        }

        const age = btn.getAttribute('data-age');
        document.getElementById('cond-age').innerText = (age && age !== 'null' && age !== '0') ? age + 'ì„¸' : 'ì •ë³´ ì—†ìŒ';

        const region = btn.getAttribute('data-region');
        document.getElementById('cond-region').innerText = (region && region !== 'null') ? region : 'ì •ë³´ ì—†ìŒ';

        const eduCode = parseInt(btn.getAttribute('data-edu')) || 0;
        document.getElementById('cond-edu').innerText = eduMap[eduCode] || eduMap[0];

        const empCode = parseInt(btn.getAttribute('data-emp')) || 0;
        let empText = 'ì •ë³´ ì—†ìŒ';
        if(empCode === 1) empText = 'ë¯¸ì·¨ì—…';
        else if(empCode === 2) empText = 'ì¬ì§ì¤‘';
        else if(empCode === 3) empText = 'ìì˜ì—…';
        else if(empCode === 4) empText = 'í”„ë¦¬ëœì„œ';
        else if(empCode === 5) empText = 'ì°½ì—…ì';
        else if(empCode === 0) empText = 'ì •ë³´ ì—†ìŒ';
        else empText = 'ê¸°íƒ€';

        document.getElementById('cond-emp').innerText = empText;

        document.getElementById('cond-marry').innerText = (btn.getAttribute('data-marry') === 'true' || btn.getAttribute('data-marry') === '1') ? 'ê¸°í˜¼' : 'ë¯¸í˜¼';
        document.getElementById('cond-family').innerText = (btn.getAttribute('data-family') || '1') + 'ëª…';
        document.getElementById('cond-child').innerText = (btn.getAttribute('data-child') || '0') + 'ëª…';

        const pIncomeAttr = btn.getAttribute('data-p-income');
        if (!pIncomeAttr || pIncomeAttr === 'null') {
            document.getElementById('cond-p-income').innerText = 'ì •ë³´ ì—†ìŒ';
        } else {
            document.getElementById('cond-p-income').innerText = parseInt(pIncomeAttr).toLocaleString() + ' ë§Œì›';
        }

        const fIncomeAttr = btn.getAttribute('data-f-income');
        if (!fIncomeAttr || fIncomeAttr === 'null') {
             document.getElementById('cond-f-income').innerText = 'ì •ë³´ ì—†ìŒ';
        } else {
             document.getElementById('cond-f-income').innerText = parseInt(fIncomeAttr).toLocaleString() + ' ë§Œì›';
        }

        document.getElementById('cond-prompt').innerText = btn.getAttribute('data-prompt') || 'ì¶”ê°€ ìš”ì²­ì‚¬í•­ ì—†ìŒ';

        const rawContent = btn.getAttribute('data-content');
        const suitability = btn.getAttribute('data-suitability');

        try {
            const data = JSON.parse(rawContent);
            const isPass = (suitability === 'Y');

            renderHeaderAndGuide(data, isPass);
            toggleSection('modal-scenarios', data.scenarios, renderScenarios);
            toggleSection('modal-recommendations', data.recommendations, renderRecommendations);
            toggleSection('modal-evidence', data.evidence, renderEvidence);

        } catch (e) {
            fallbackToTextMode(rawContent);
        }
        document.getElementById('detail-modal').classList.remove('hidden');
    }

    function renderHeaderAndGuide(data, isPass) {
        const bg = document.getElementById('modal-header-bg');
        const text = document.getElementById('modal-suitability-text');
        const badge = document.getElementById('modal-status-badge');
        const icon = document.getElementById('modal-quote-icon');

        if (isPass) {
            bg.className = "p-8 text-white relative overflow-hidden bg-gradient-to-r from-blue-600 to-indigo-600";
            text.innerText = "ì¶•í•˜í•©ë‹ˆë‹¤! ì‹ ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤.";
            badge.innerHTML = '<i class="fa-solid fa-check-circle mr-2"></i>PASS';
            icon.className = "fa-solid fa-quote-left text-blue-500";
        } else {
            bg.className = "p-8 text-white relative overflow-hidden bg-gradient-to-r from-red-500 to-orange-500";
            text.innerText = "ì•„ì‰½ì§€ë§Œ ì‹ ì²­ì´ ì–´ë µìŠµë‹ˆë‹¤.";
            badge.innerHTML = '<i class="fa-solid fa-circle-exclamation mr-2"></i>FAIL';
            icon.className = "fa-solid fa-quote-left text-red-500";
        }

        let guide = data.content || "";
        if (data.answer) guide += "\n\n" + data.answer;
        document.getElementById('modal-ai-guide').innerHTML = marked.parse(guide);
    }

    function toggleSection(elementId, data, renderFunc) {
        const container = document.getElementById(elementId);
        const parentCard = container.parentElement;
        if (!data || data.length === 0) {
            parentCard.classList.add('hidden');
        } else {
            parentCard.classList.remove('hidden');
            renderFunc(data);
        }
    }

    function renderScenarios(scenarios) {
        const container = document.getElementById('modal-scenarios');
        container.innerHTML = '';
        scenarios.forEach(s => {
            const styles = {
                'risk': { bg: 'bg-amber-50', border: 'border-amber-200', icon: 'fa-triangle-exclamation text-amber-500' },
                'benefit': { bg: 'bg-blue-50', border: 'border-blue-200', icon: 'fa-rocket text-blue-500' },
                'solution': { bg: 'bg-emerald-50', border: 'border-emerald-200', icon: 'fa-lightbulb text-emerald-500' },
                'roadmap': { bg: 'bg-purple-50', border: 'border-purple-200', icon: 'fa-map-location-dot text-purple-500' }
            };
            const style = styles[s.type] || { bg: 'bg-slate-50', border: 'border-slate-200', icon: 'fa-info-circle text-slate-400' };
            const div = document.createElement('div');
            div.className = `rounded-xl p-4 border transition-all ${style.bg} ${style.border}`;
            div.innerHTML = `<div class="flex items-start gap-3"><div class="mt-0.5 text-lg"><i class="fa-solid ${style.icon}"></i></div><div class="flex-1"><h4 class="font-bold text-sm mb-1 text-slate-900">${s.title}</h4><p class="text-sm text-slate-700 leading-relaxed">${s.content}</p></div></div>`;
            container.appendChild(div);
        });
    }

    // [ìˆ˜ì •] ìì„¸íˆ ë²„íŠ¼ ì¶”ê°€
    function renderRecommendations(recs) {
        const container = document.getElementById('modal-recommendations');
        container.innerHTML = '';
        recs.forEach(r => {
            const li = document.createElement('li');
            li.className = "flex items-center justify-between p-3 bg-white rounded-lg border border-slate-100 hover:border-blue-200 hover:shadow-md transition group";
            li.innerHTML = `
                <div class="flex flex-col flex-1 pr-3">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-blue-500 text-xs group-hover:scale-110 transition-transform">ğŸ”—</span>
                        <strong class="text-slate-800 text-sm">${r.name}</strong>
                    </div>
                    <p class="text-xs text-slate-500 pl-6 leading-relaxed">${r.reason}</p>
                </div>
                <button onclick="openDetailById('${r.id}')" class="flex-shrink-0 bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold text-[11px] px-3 py-1 rounded-lg transition flex items-center gap-1">
                    <span>ìì„¸íˆ</span>
                    <i class="fa-solid fa-chevron-right text-[9px]"></i>
                </button>
            `;
            container.appendChild(li);
        });
    }

    function renderEvidence(evidence) {
        const container = document.getElementById('modal-evidence');
        container.innerHTML = '';
        evidence.forEach(e => {
            let badgeClass = e.type === 'ë²•ë ¹' ? "bg-blue-100 text-blue-700" : "bg-orange-100 text-orange-700";
            const div = document.createElement('div');
            div.className = "bg-white border border-slate-200 rounded-xl p-4 shadow-sm";
            div.innerHTML = `<div class="flex items-center gap-2 mb-2"><span class="${badgeClass} px-2 py-1 rounded text-xs font-bold">${e.type}</span><span class="font-bold text-slate-700 text-sm">${e.title}</span></div><div class="bg-slate-50 p-2 rounded text-xs text-slate-600"><span class="text-blue-600 font-bold mr-1">âœ”</span><span>${e.match_info}</span></div>`;
            container.appendChild(div);
        });
    }

    function fallbackToTextMode(text) {
        const bg = document.getElementById('modal-header-bg');
        bg.className = "p-8 text-white relative overflow-hidden bg-gradient-to-r from-slate-500 to-slate-600";
        document.getElementById('modal-suitability-text').innerText = "ë¶„ì„ ê²°ê³¼ (êµ¬ë²„ì „)";
        document.getElementById('modal-status-badge').innerText = "RECORD";
        document.getElementById('modal-ai-guide').innerText = text;
        document.getElementById('modal-scenarios').parentElement.classList.add('hidden');
        document.getElementById('modal-recommendations').parentElement.classList.add('hidden');
        document.getElementById('modal-evidence').parentElement.classList.add('hidden');
    }

    let deleteTargetIds = [];
    function openDeleteModal() {
        const checkedBoxes = document.querySelectorAll('input[name="recordChk"]:checked');
        deleteTargetIds = Array.from(checkedBoxes).map(cb => cb.value);
        if (deleteTargetIds.length === 0) { alert("ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
        document.getElementById('delete-modal').classList.remove('hidden');
        setTimeout(() => {
             document.getElementById('delete-content').classList.remove('scale-95', 'opacity-0');
             document.getElementById('delete-content').classList.add('scale-100', 'opacity-100');
        }, 10);
    }
    function deleteSingle(id) {
        deleteTargetIds = [id];
        document.getElementById('delete-modal').classList.remove('hidden');
        setTimeout(() => {
             document.getElementById('delete-content').classList.remove('scale-95', 'opacity-0');
             document.getElementById('delete-content').classList.add('scale-100', 'opacity-100');
        }, 10);
    }
    function closeDeleteModal() {
        const content = document.getElementById('delete-content');
        content.classList.remove('scale-100', 'opacity-100');
        content.classList.add('scale-95', 'opacity-0');
        setTimeout(() => document.getElementById('delete-modal').classList.add('hidden'), 200);
    }
    function confirmDelete() {
        fetch('/api/record/delete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(deleteTargetIds)
        }).then(res => { if (res.ok) location.reload(); });
    }
    document.addEventListener('keydown', function(event) { if (event.key === "Escape") { closeDetailModal(); closeDeleteModal(); } });
</script>
</body>
</html>