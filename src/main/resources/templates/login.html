<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoliSight - 로그인</title>

    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

    <style>
        :root {
            --primary-color: #007bff;
            --primary-hover: #0056b3;
            --bg-gradient: linear-gradient(135deg, #f4f7f9 0%, #e9eff5 100%);
            --text-main: #222;
            --text-sub: #666;
            --error-color: #e74c3c;
            --input-bg: #fdfdfd;
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background: var(--bg-gradient);
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .auth-box {
            background: #fff;
            width: 100%;
            max-width: 420px;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .logo-container {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            margin-bottom: 30px; cursor: pointer;
        }
        .logo-symbol {
            width: 36px; height: 36px; background-color: var(--primary-color); color: white;
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: 20px; box-shadow: 0 2px 5px rgba(0,123,255,0.3);
        }
        .logo-text { font-size: 30px; font-weight: 900; color: var(--primary-color); letter-spacing: -1px; }

        .tab-menu { display: flex; margin-bottom: 30px; border-bottom: 2px solid #eee; }
        .tab-item { flex: 1; text-align: center; padding: 12px 0; cursor: pointer; color: var(--text-sub); font-weight: 600; font-size: 15px; transition: all 0.3s; }
        .tab-item.active { color: var(--primary-color); border-bottom: 3px solid var(--primary-color); margin-bottom: -2.5px; }

        .form-section { display: none; }
        .form-section.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .input-group { margin-bottom: 16px; }
        label { display: block; font-size: 13px; font-weight: 800; margin-bottom: 8px; color: var(--text-main); }
        input, select { width: 100%; padding: 14px 16px; border: 1px solid #e1e1e1; border-radius: 12px; font-size: 14px; font-weight: 500; box-sizing: border-box; background: var(--input-bg); transition: all 0.2s; color: var(--text-main); }
        input::placeholder { color: #aaa; font-weight: 400; }
        input:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 3px rgba(0,123,255,0.1); background: #fff; }

        .row { display: flex; gap: 8px; }
        .btn-inline { background: #444; color: white; border: none; border-radius: 10px; padding: 0 14px; cursor: pointer; font-size: 12px; font-weight: 600; white-space: nowrap; }
        .helper-text { font-size: 11px; color: #888; margin-top: 5px; line-height: 1.4; }
        .error-msg { color: var(--error-color); font-size: 11px; margin-top: 5px; display: none; }

        .submit-btn { width: 100%; padding: 16px; background: var(--primary-color); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 10px; box-shadow: 0 6px 15px rgba(0,123,255,0.2); transition: all 0.2s; }
        .submit-btn:hover { background: var(--primary-hover); transform: translateY(-2px); }

        .find-desc { font-size: 13px; color: var(--text-sub); margin-bottom: 15px; text-align: center; line-height: 1.6; }
        .divider { margin: 24px 0; border-top: 1px dashed #ddd; position: relative; }
        .divider::after { content: "OR"; position: absolute; top: -9px; left: 50%; transform: translateX(-50%); background: #fff; padding: 0 10px; font-size: 11px; color: #aaa; }

        /* Setup Info Alert Style */
        .setup-alert {
            background-color: #f0f7ff; border: 1px solid #cce5ff; color: #004085;
            padding: 12px; border-radius: 10px; margin-bottom: 20px;
            font-size: 12px; font-weight: 700; text-align: center;
            display: none; /* 기본 숨김 */
            align-items: center; justify-content: center; gap: 6px;
        }

        #signupSection .input-group, #findSection .input-group { margin-bottom: 10px; }
        #signupSection label, #findSection label { margin-bottom: 4px; font-size: 12px; }
        #signupSection input, #signupSection select, #findSection input { padding: 10px 12px; font-size: 13px; border-radius: 8px; }
        #signupSection .submit-btn, #findSection .submit-btn { padding: 14px; font-size: 15px; margin-top: 5px; }
    </style>
</head>
<body>

<div class="auth-box">
    <div class="logo-container" onclick="location.href='/'">
        <div class="logo-symbol">P</div>
        <div class="logo-text">PoliSight</div>
    </div>

    <div class="tab-menu">
        <div class="tab-item active" onclick="switchTab('login')">로그인</div>
        <div class="tab-item" onclick="switchTab('signup')">회원가입</div>
        <div class="tab-item" onclick="switchTab('find')">계정찾기</div>
    </div>

    <section id="loginSection" class="form-section active">
        <form th:action="@{/login}" method="post">
            <div class="input-group"><label>아이디</label><input type="text" name="userId" placeholder="아이디를 입력해 주세요"></div>
            <div class="input-group"><label>비밀번호</label><input type="password" name="userPw" placeholder="비밀번호를 입력해 주세요"></div>
            <div th:if="${param.error}" class="error-msg" style="display:block; text-align:center; margin-bottom:10px;">아이디 또는 비밀번호가 잘못되었습니다.</div>
            <button class="submit-btn" type="submit">로그인</button>
        </form>
    </section>

    <section id="signupSection" class="form-section">
        <div id="setupInfoMsg" class="setup-alert">
            <span style="font-size: 14px;">✨</span> 조건 설정 정보를 자동으로 불러왔습니다!
        </div>

        <form id="signupForm" th:action="@{/join}" method="post">
            <div class="input-group"><label>이름 (본명)</label><input type="text" name="userName" placeholder="성함을 입력하세요" required></div>
            <div class="input-group"><label>아이디</label><div class="row"><input type="text" id="regId" name="userId" placeholder="4~15자 (소문자/숫자)" required><button type="button" class="btn-inline" onclick="checkDuplicate()">중복확인</button></div><p id="idError" class="error-msg">형식에 맞지 않는 아이디입니다.</p></div>
            <div class="input-group"><label>비밀번호</label><input type="password" id="regPw" name="userPw" placeholder="6~20자 (특수문자 포함)" required><input type="password" id="regPwConfirm" placeholder="비밀번호 확인" style="margin-top: 6px;" required><p id="pwError" class="error-msg">비밀번호가 일치하지 않습니다.</p></div>
            <div class="input-group"><label>이메일</label><div class="row"><input type="email" id="regEmail" name="email" placeholder="auth@polisight.com" required><button type="button" class="btn-inline">인증요청</button></div></div>
            <div class="input-group"><label>생년월일</label><div class="row"><select id="year" name="birthYear"></select><select id="month" name="birthMonth"></select><select id="day" name="birthDay"></select></div></div>
            <button type="submit" class="submit-btn">가입 완료</button>
        </form>
    </section>

    <section id="findSection" class="form-section">
        <div class="find-group"><p class="find-desc" style="margin-bottom: 10px;"><strong>아이디 찾기</strong></p><div class="input-group"><label>이름</label><input type="text" placeholder="성함을 입력하세요"></div><div class="input-group"><label>이메일 주소</label><input type="email" placeholder="이메일을 입력하세요"></div><button class="submit-btn" style="background: #444; box-shadow: none;">아이디 찾기</button></div>
        <div class="divider"></div>
        <div class="find-group"><p class="find-desc" style="margin-bottom: 10px;"><strong>비밀번호 재설정</strong></p><div class="input-group"><label>아이디</label><input type="text" placeholder="아이디를 입력하세요"></div><div class="input-group"><label>이메일 주소</label><input type="email" placeholder="이메일을 입력하세요"></div><button class="submit-btn">재설정 링크 발송</button></div>
    </section>
</div>

<script>
    // 탭 전환 함수
    function switchTab(type) {
        const tabs = document.querySelectorAll('.tab-item');
        const sections = document.querySelectorAll('.form-section');
        tabs.forEach(t => t.classList.remove('active'));
        sections.forEach(s => s.classList.remove('active'));

        if(type === 'login') { tabs[0].classList.add('active'); document.getElementById('loginSection').classList.add('active'); }
        else if(type === 'signup') { tabs[1].classList.add('active'); document.getElementById('signupSection').classList.add('active'); }
        else { tabs[2].classList.add('active'); document.getElementById('findSection').classList.add('active'); }
    }

    // 생년월일 Select Box 생성
    const yearS = document.getElementById('year');
    const monthS = document.getElementById('month');
    const dayS = document.getElementById('day');
    yearS.add(new Option('년도', '')); monthS.add(new Option('월', '')); dayS.add(new Option('일', ''));
    for(let i=2025; i>=1950; i--) yearS.add(new Option(i+'년', i));
    for(let i=1; i<=12; i++) monthS.add(new Option(i+'월', i));
    for(let i=1; i<=31; i++) dayS.add(new Option(i+'일', i));

    // 페이지 로드 시 실행 (setup.html 데이터 연동 로직)
    document.addEventListener("DOMContentLoaded", function() {
        const urlParams = new URLSearchParams(window.location.search);

        // 1. URL 파라미터 확인 (?mode=signup) -> 회원가입 탭 열기
        if (urlParams.get('mode') === 'signup') {
            switchTab('signup');
        }

        // 2. Setup 데이터 확인 및 자동 기입
        const setupData = localStorage.getItem('userSetupData');
        if (setupData) {
            const data = JSON.parse(setupData);

            // 생년월일 데이터가 있고, 형식이 맞다면 (YYYYMMDD)
            if(data.birthDate && data.birthDate.length === 8) {
                const y = data.birthDate.substring(0, 4);
                const m = parseInt(data.birthDate.substring(4, 6)); // '05' -> 5 (Select Value 매칭)
                const d = parseInt(data.birthDate.substring(6, 8)); // '01' -> 1

                document.getElementById('year').value = y;
                document.getElementById('month').value = m;
                document.getElementById('day').value = d;

                // 안내 메시지 표시
                document.getElementById('setupInfoMsg').style.display = 'flex';
            }
            // (옵션) 사용한 데이터는 삭제하거나 유지 (여기서는 유지)
        }
    });

    // 기존 유효성 검사 로직
    document.getElementById('regId').addEventListener('input', function() { const regex = /^[a-z0-9]{4,15}$/; document.getElementById('idError').style.display = (this.value === '' || regex.test(this.value)) ? 'none' : 'block'; });
    const pw = document.getElementById('regPw');
    const pwConfirm = document.getElementById('regPwConfirm');
    function checkPw() { document.getElementById('pwError').style.display = (pw.value && pwConfirm.value && pw.value !== pwConfirm.value) ? 'block' : 'none'; }
    pw.addEventListener('input', checkPw); pwConfirm.addEventListener('input', checkPw);
    function checkDuplicate() { alert('서버 연결이 필요합니다.'); }
</script>

</body>
</html>