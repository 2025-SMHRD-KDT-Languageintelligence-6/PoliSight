<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PoliSight - AI 지역 정책 영향 시뮬레이터</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* 폰트 적용 */
        body { font-family: 'Pretendard', 'Noto Sans KR', sans-serif; }

        /* 가로 스크롤 차단 */
        html, body {
            overflow-x: hidden;
            width: 100%;
            max-width: 100%;
        }

        .gradient-text {
            background: linear-gradient(to right, #2563EB, #0ea5e9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* 배경 블러 효과 */
        .blob {
            position: absolute;
            filter: blur(50px);
            opacity: 0.5;
        }
        @media (min-width: 768px) {
            .blob { filter: blur(80px); }
        }

        .animate-fade-up {
            animation: fadeUp 1.5s cubic-bezier(0.3, 0.8, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(30px);
        }

        @keyframes fadeUp {
            to { opacity: 1; transform: translateY(0); }
        }

        .delay-100 { animation-delay: 0.4s; }
        .delay-200 { animation-delay: 0.7s; }
        .delay-300 { animation-delay: 1.0s; }

        /* 캔버스 및 텍스트 효과 스타일 */
        #canvas-wrapper {
            position: relative;
            width: 100%;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 10;
        }

        @media (max-width: 768px) {
            #canvas-wrapper { height: 240px; }
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #final-text-container {
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            pointer-events: none;
            position: absolute;
            width: 100%;
            padding: 0 1rem;
        }

        #final-text-container.visible {
            opacity: 1;
            pointer-events: auto;
        }

        /* 클릭 유도 힌트 애니메이션 */
        .click-hint {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.5; transform: scale(1); }
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen relative" id="top-section">

<div class="absolute inset-0 w-full h-full overflow-hidden pointer-events-none -z-10">
    <div class="blob w-64 h-64 md:w-[500px] md:h-[500px] bg-blue-100/60 rounded-full top-0 left-0 -translate-x-1/4 -translate-y-1/4 md:-translate-x-1/3 md:-translate-y-1/3"></div>
    <div class="blob w-64 h-64 md:w-[500px] md:h-[500px] bg-indigo-100/60 rounded-full bottom-0 right-0 translate-x-1/4 translate-y-1/4"></div>
</div>

<div th:replace="HF :: header('intro')"></div>

<main class="flex-grow flex items-center justify-center relative w-full py-10 md:py-0 min-h-[600px] md:h-screen overflow-x-hidden">

    <div class="max-w-7xl mx-auto px-6 md:px-4 text-center z-10 flex flex-col items-center justify-center mb-10 md:mb-32 w-full">

        <div class="animate-fade-up mb-6 md:mb-8">
            <span class="inline-flex items-center gap-2 py-1.5 px-4 md:py-2 md:px-5 rounded-full bg-blue-50 text-blue-600 text-xs md:text-sm font-bold border border-blue-100 shadow-sm hover:shadow-md transition cursor-default">
                <span class="relative flex h-2 w-2 md:h-2.5 md:w-2.5">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 md:h-2.5 md:w-2.5 bg-blue-500"></span>
                </span>
                AI 기반 정책 영향 분석 서비스
            </span>
        </div>

        <div id="canvas-wrapper" onclick="explodeText()" class="mb-8 md:mb-12 animate-fade-up delay-100">
            <canvas id="textCanvas"></canvas>

            <div id="click-hint-msg" class="absolute bottom-0 text-slate-600 text-base click-hint pointer-events-none">
                <i class="fa-solid fa-arrow-pointer mr-1"></i> 클릭해서 고민을 날려버리세요
            </div>

            <div id="final-text-container">
                <h1 class="text-3xl sm:text-4xl md:text-6xl font-bold leading-snug md:leading-tight tracking-tight break-keep break-words w-full">
                    막연한 걱정 대신 <span class="gradient-text">시뮬레이션</span> 하세요.<br>
                    <span class="block mt-4 md:mt-6 text-2xl md:text-4xl text-slate-600 font-medium">
                        상황 변화에 따른 수급 자격 유지 여부<br>
                        <strong class="text-blue-600">PoliSigh</strong>가 미리 알려드립니다.
                    </span>
                </h1>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row justify-center gap-4 md:gap-5 w-full sm:w-auto animate-fade-up delay-200 px-4 sm:px-0">
            <a th:href="${session.loginMember != null} ? @{/policy} : @{/setup}"
               class="group bg-blue-600 hover:bg-blue-700 text-white px-6 py-3.5 md:px-10 md:py-4 rounded-xl md:rounded-2xl text-base md:text-lg font-bold shadow-xl shadow-blue-200 transition transform hover:-translate-y-1 flex items-center justify-center gap-3 w-full sm:w-auto">
                지금 무료로 시뮬레이션 하기
                <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition"></i>
            </a>
        </div>

    </div>

    <div onclick="document.getElementById('next-section').scrollIntoView({ behavior: 'smooth' })"
         class="absolute bottom-2 md:bottom-8 left-0 right-0 mx-auto w-fit flex flex-col items-center animate-bounce z-20 cursor-pointer opacity-60 hover:opacity-100 transition p-2">
        <span class="text-[10px] md:text-xs font-medium text-slate-400 mb-1 md:mb-2 text-center">SCROLL</span>
        <i class="fa-solid fa-chevron-down text-slate-400 text-xl md:text-2xl"></i>
    </div>
</main>

<section id="next-section" class="bg-white py-20 md:py-32 border-t border-slate-100 relative z-20 w-full overflow-hidden">
    <div class="max-w-7xl mx-auto px-6 md:px-4">

        <div class="text-center mb-24">
            <h2 class="text-3xl md:text-5xl font-bold text-slate-900 mb-6">
                PoliSight가 제공하는 <span class="text-blue-600">특별한 경험</span>
            </h2>
            <p class="text-lg text-slate-500">단순한 정책 검색을 넘어, 당신의 미래를 예측하고 대비합니다.</p>
        </div>

        <div class="flex flex-col gap-24 md:gap-32">

            <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-20">
                <div class="flex-1 space-y-6 order-2 lg:order-1 text-center lg:text-left">
                    <div class="inline-flex items-center gap-2 px-3 py-1 bg-indigo-50 text-indigo-600 rounded-full text-sm font-semibold">
                        <i class="fa-solid fa-database"></i> 실시간 데이터 분석
                    </div>
                    <h3 class="text-3xl md:text-4xl font-bold leading-tight text-slate-900 break-keep">
                        매일 아침,<br> 우리 동네 정책이 새로워집니다.
                    </h3>
                    <p class="text-lg text-slate-600 leading-relaxed break-keep">
                        흩어져 있는 수십 개의 지자체 공고문, 일일이 찾아다니기 힘드셨죠? PoliSight는 RAG(검색 증강 생성)기술을 활용해 매일 새로운 공고문을 자동으로 수집하고 분석합니다. 어제 발표된 지원금 소식, 놓치지 말고 오늘 바로 확인하세요.
                    </p>
                </div>
                <div class="flex-1 w-full order-1 lg:order-2">
                    <div class="relative aspect-video bg-indigo-50 rounded-3xl overflow-hidden shadow-2xl border-4 border-white flex items-center justify-center group hover:scale-[1.02] transition duration-500">
                        <img src="/image/ii1.png" alt="실시간 데이터 분석" class="w-full h-full object-cover">
                    </div>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-20">
                <div class="flex-1 w-full">
                    <div class="relative aspect-video bg-emerald-50 rounded-3xl overflow-hidden shadow-2xl border-4 border-white flex items-center justify-center group hover:scale-[1.02] transition duration-500">
                        <img src="/image/ii2.png" alt="변경 시나리오 예측" class="w-full h-full object-cover">
                    </div>
                </div>
                <div class="flex-1 space-y-6 text-center lg:text-left">
                    <div class="inline-flex items-center gap-2 px-3 py-1 bg-emerald-50 text-emerald-600 rounded-full text-sm font-semibold">
                        <i class="fa-solid fa-scale-balanced"></i> 변경 시나리오 예측
                    </div>
                    <h3 class="text-3xl md:text-4xl font-bold leading-tight text-slate-900 break-keep">
                        내 조건이 바뀌면?<br> 결과도 바뀝니다.
                    </h3>
                    <p class="text-lg text-slate-600 leading-relaxed break-keep">
                        "이직해서 연봉이 오르면 지원금을 못 받을까?", "결혼하면 어떤 혜택이 생길까?"  막연한 걱정보다, 한 발 앞선 선택을 할 수 있도록.
                        막막한 미래를 AI가 시뮬레이션해드립니다. 다양한 가정 상황을 설정하여 당신의 변화된 내일에 딱 맞는 정책 결과를 미리 예측해 보세요.
                    </p>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-20">
                <div class="flex-1 space-y-6 order-2 lg:order-1 text-center lg:text-left">
                    <div class="inline-flex items-center gap-2 px-3 py-1 bg-orange-50 text-orange-600 rounded-full text-sm font-semibold">
                        <i class="fa-solid fa-comments"></i> AI 정책 전문가 리아
                    </div>
                    <h3 class="text-3xl md:text-4xl font-bold leading-tight text-slate-900 break-keep">
                        Live2D로 만나는<br>AI 정책 전문가 리아
                    </h3>
                    <p class="text-lg text-slate-600 leading-relaxed break-keep">
                        행정 용어로 가득 찬 딱딱한 공고문 때문에 고민인가요? 이제 실시간 Live2D 기술로 생생하게 반응하는 AI 전문가 리아를 만나보세요.
                        리아는 정책의 핵심을 쏙쏙 뽑아 요약해 줄 뿐만 아니라,
                        검색부터 시뮬레이션 결과 해석까지 사이트 이용의 모든 과정을 옆에서 대화하듯 친절하게 안내해 드립니다.
                    </p>
                </div>
                <div class="flex-1 w-full order-1 lg:order-2">
                    <div class="relative aspect-video bg-orange-50 rounded-3xl overflow-hidden shadow-2xl border-4 border-white flex items-center justify-center group cursor-pointer">
                        <div class="absolute inset-0 bg-gradient-to-br from-orange-50 to-orange-100 opacity-50"></div>
                        <img src="/image/ii3.png" alt="AI 정책 전문가 리아" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500 relative z-10">
                        <span class="absolute bottom-4 text-orange-300 text-sm z-20 font-bold drop-shadow-md">PoliSight Members Only</span>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>

<div id="scrollTopBtn"
     onclick="window.scrollTo({ top: 0, behavior: 'smooth' })"
     class="fixed bottom-8 right-8 w-12 h-12 bg-white border border-slate-200 shadow-lg rounded-full flex items-center justify-center cursor-pointer hover:-translate-y-1 transition-all duration-300 text-slate-900 hover:text-blue-600 z-50 opacity-0 invisible translate-y-4">
    <i class="fa-solid fa-chevron-up text-xl"></i>
</div>

<div th:replace="HF :: footer"></div>

<script>
    // --- [수정2 적용] 물결 효과 설정값 변경 ---
    const WAVE_CONFIG = {
        amplitude: 0.8,  // 0.4 -> 0.8 (물결 높이 증가)
        frequency: 0.03, // 0.01 -> 0.03 (물결 간격 촘촘하게)
        speed: 0.03      // 0.01 -> 0.03 (속도 빠르게)
    };

    const canvas = document.getElementById('textCanvas');
    const ctx = canvas.getContext('2d');

    // 메모리상의 가상 캔버스 (원본 텍스트 보관용)
    let bufferCanvas = document.createElement('canvas');
    let bufferCtx = bufferCanvas.getContext('2d');

    const finalTextContainer = document.getElementById('final-text-container');
    const clickHint = document.getElementById('click-hint-msg');

    let particles = [];
    let isExploded = false;
    let time = 0;
    let animationFrameId;

    // 1. 텍스트 설정 (반응형)
    function getSettings() {
        if (window.innerWidth < 768) {
            return {
                lines: ["남들은 혜택 받는다던데,", "나도 해당될까?", "내 조건이 바뀌어도", "계속 받을 수 있을까?"],
                fontSize: 28, lineHeight: 40, color: "#475569"
            };
        } else {
            return {
                lines: ["남들은 혜택 받는다던데, 나도 해당될까?", "내 조건이 바뀌어도 계속 받을 수 있을까?"],
                fontSize: 48, lineHeight: 70, color: "#334155"
            };
        }
    }

    // 2. 초기화 및 리사이즈 (핵심: 너비 0일 때 방어)
    function resize() {
        const wrapper = document.getElementById('canvas-wrapper');
        if (!wrapper) return;

        const w = wrapper.offsetWidth;
        const h = wrapper.offsetHeight;

        // [안전장치] 너비가 0이면 아직 준비 안 된 것이므로 중단
        if (w === 0 || h === 0) return;

        // 캔버스 크기 맞춤
        canvas.width = w;
        canvas.height = h;
        bufferCanvas.width = w;
        bufferCanvas.height = h;

        // 폭발 전이라면 버퍼에 원본 텍스트 다시 그림
        if (!isExploded) {
            drawTextToBuffer();
        }
    }

    // 3. 버퍼에 텍스트 그리기 (화면엔 안 나옴)
    function drawTextToBuffer() {
        const settings = getSettings();

        bufferCtx.clearRect(0, 0, bufferCanvas.width, bufferCanvas.height);
        bufferCtx.fillStyle = settings.color;
        bufferCtx.font = `bold ${settings.fontSize}px 'Pretendard', sans-serif`;
        bufferCtx.textAlign = "center";
        bufferCtx.textBaseline = "middle";

        const totalHeight = settings.lines.length * settings.lineHeight;
        let startY = (bufferCanvas.height - totalHeight) / 2 + (settings.lineHeight / 2);

        settings.lines.forEach((line, index) => {
            bufferCtx.fillText(line, bufferCanvas.width / 2, startY + (index * settings.lineHeight));
        });
    }

    // 4. 물결 애니메이션 (실제 화면에 그리기)
    function renderWave() {
        if (isExploded) return;

        // [안전장치] 캔버스 크기가 0이면 그리지 않고 다음 프레임 대기
        if (canvas.width === 0) {
            requestAnimationFrame(renderWave);
            return;
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        time += WAVE_CONFIG.speed;

        // 최적화: 2px 단위로 잘라서 옮기기
        const slice = 2;

        for (let x = 0; x < canvas.width; x += slice) {
            // sin 함수로 Y축 흔들림 계산
            const yOffset = Math.sin(x * WAVE_CONFIG.frequency + time) * WAVE_CONFIG.amplitude;

            // 버퍼(원본)에서 잘라와서 -> 화면에 yOffset 만큼 옮겨 그림
            ctx.drawImage(
                bufferCanvas,
                x, 0, slice, canvas.height,     // 원본 위치
                x, yOffset, slice, canvas.height // 화면 위치
            );
        }

        animationFrameId = requestAnimationFrame(renderWave);
    }

    // 5. 안전한 앱 시작 (흰 화면 방지 로직)
    function initApp() {
        const wrapper = document.getElementById('canvas-wrapper');

        // 아직 화면이 안 떴거나, 너비가 0이면 계속 대기
        if (!wrapper || wrapper.offsetWidth === 0) {
            requestAnimationFrame(initApp);
            return;
        }

        // 너비가 잡히면 그때 시작!
        resize();
        renderWave();
    }

    // --- 파티클 폭발 효과 ---
    function createParticles() {
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        particles = [];
        const step = 2; // 입자 밀도

        for (let y = 0; y < canvas.height; y += step) {
            for (let x = 0; x < canvas.width; x += step) {
                const index = (y * canvas.width + x) * 4;
                if (data[index + 3] > 0) {
                    particles.push({
                        x: x, y: y,
                        color: `rgba(${data[index]}, ${data[index+1]}, ${data[index+2]}, ${data[index+3]})`,
                        vx: (Math.random() - 0.5) * 4,
                        vy: (Math.random() - 0.5) * 4,
                        life: Math.random() * 30 + 50,
                        size: Math.random() * 2 + 1
                    });
                }
            }
        }
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        animateParticles();
    }

    function animateParticles() {
        if (particles.length === 0) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < particles.length; i++) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy;
            p.vx *= 0.95; p.vy *= 0.95; p.vy -= 0.1;
            p.life--;
            if (p.life > 0) {
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            }
        }
        requestAnimationFrame(animateParticles);
    }

    window.explodeText = function() {
        if (!isExploded) {
            isExploded = true;
            cancelAnimationFrame(animationFrameId); // 물결 멈춤
            if(clickHint) clickHint.style.display = 'none';
            createParticles(); // 폭발 시작
            setTimeout(() => {
                finalTextContainer.classList.add('visible');
            }, 800);
        }
    };

    window.addEventListener('resize', resize);

    // [시작점] 앱 초기화 시작
    initApp();

    // 폰트 로딩 완료 시 혹시 모르니 재조정
    document.fonts.ready.then(resize);

    // [추가] 스크롤 시 Top 버튼 표시/숨김 로직
    const scrollBtn = document.getElementById('scrollTopBtn');
    window.addEventListener('scroll', () => {
        // 스크롤이 300px 이상 내려갔을 때 버튼 표시
        if (window.scrollY > 300) {
            scrollBtn.classList.remove('opacity-0', 'invisible', 'translate-y-4');
            scrollBtn.classList.add('opacity-100', 'visible', 'translate-y-0');
        } else {
            scrollBtn.classList.add('opacity-0', 'invisible', 'translate-y-4');
            scrollBtn.classList.remove('opacity-100', 'visible', 'translate-y-0');
        }
    });

</script>

</body>
</html>