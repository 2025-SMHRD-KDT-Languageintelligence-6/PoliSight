<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PoliSight - AI 지역 정책 영향 시뮬레이터</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* 폰트 적용 */
        body { font-family: 'Pretendard', 'Noto Sans KR', sans-serif; }

        /* 가로 스크롤 차단 */
        html, body {
            overflow-x: hidden;
            width: 100%;
            max-width: 100%;
        }

        .gradient-text {
            background: linear-gradient(to right, #2563EB, #0ea5e9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* 배경 블러 효과 */
        .blob {
            position: absolute;
            filter: blur(50px);
            opacity: 0.5;
        }
        @media (min-width: 768px) {
            .blob { filter: blur(80px); }
        }

        .animate-fade-up {
            animation: fadeUp 1.5s cubic-bezier(0.3, 0.8, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(30px);
        }

        @keyframes fadeUp {
            to { opacity: 1; transform: translateY(0); }
        }

        .delay-100 { animation-delay: 0.4s; }
        .delay-200 { animation-delay: 0.7s; }
        .delay-300 { animation-delay: 1.0s; }

        /* 캔버스 및 텍스트 효과 스타일 */
        #canvas-wrapper {
            position: relative;
            width: 100%;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 10;
        }

        @media (max-width: 768px) {
            #canvas-wrapper { height: 240px; }
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #final-text-container {
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            pointer-events: none;
            position: absolute;
            width: 100%;
            padding: 0 1rem;
        }

        #final-text-container.visible {
            opacity: 1;
            pointer-events: auto;
        }

        /* 클릭 유도 힌트 애니메이션 */
        .click-hint {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.5; transform: scale(1); }
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen relative" id="top-section">

<div class="absolute inset-0 w-full h-full overflow-hidden pointer-events-none -z-10">
    <div class="blob w-64 h-64 md:w-[500px] md:h-[500px] bg-blue-100/60 rounded-full top-0 left-0 -translate-x-1/4 -translate-y-1/4 md:-translate-x-1/3 md:-translate-y-1/3"></div>
    <div class="blob w-64 h-64 md:w-[500px] md:h-[500px] bg-indigo-100/60 rounded-full bottom-0 right-0 translate-x-1/4 translate-y-1/4"></div>
</div>

<div th:replace="HF :: header('intro')"></div>

<main class="flex-grow flex items-center justify-center relative w-full py-10 md:py-0 min-h-[600px] md:h-screen overflow-x-hidden">

    <div class="max-w-7xl mx-auto px-6 md:px-4 text-center z-10 flex flex-col items-center justify-center mb-10 md:mb-32 w-full">

        <div class="animate-fade-up mb-6 md:mb-8">
            <span class="inline-flex items-center gap-2 py-1.5 px-4 md:py-2 md:px-5 rounded-full bg-blue-50 text-blue-600 text-xs md:text-sm font-bold border border-blue-100 shadow-sm hover:shadow-md transition cursor-default">
                <span class="relative flex h-2 w-2 md:h-2.5 md:w-2.5">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 md:h-2.5 md:w-2.5 bg-blue-500"></span>
                </span>
                AI 기반 정책 영향 분석 서비스
            </span>
        </div>

        <div id="canvas-wrapper" onclick="explodeText()" class="mb-8 md:mb-12 animate-fade-up delay-100">
            <canvas id="textCanvas"></canvas>

            <div id="click-hint-msg" class="absolute bottom-0 text-slate-600 text-base click-hint pointer-events-none">
                <i class="fa-solid fa-arrow-pointer mr-1"></i> 고민을 클릭해서 날려버리세요
            </div>

            <div id="final-text-container">
                <h1 class="text-3xl sm:text-4xl md:text-6xl font-bold leading-snug md:leading-tight tracking-tight break-keep break-words w-full">
                    막연한 걱정 대신 <span class="gradient-text">시뮬레이션</span> 하세요.<br>
                    <span class="block mt-4 md:mt-6 text-2xl md:text-4xl text-slate-600 font-medium">
                        상황 변화에 따른 수급 자격 유지 여부<br>
                        <strong class="text-blue-600">폴리사이트</strong>가 미리 알려드립니다.
                    </span>
                </h1>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row justify-center gap-4 md:gap-5 w-full sm:w-auto animate-fade-up delay-200 px-4 sm:px-0">
            <a th:href="${session.loginMember != null} ? @{/policy} : @{/setup}"
               class="group bg-blue-600 hover:bg-blue-700 text-white px-6 py-3.5 md:px-10 md:py-4 rounded-xl md:rounded-2xl text-base md:text-lg font-bold shadow-xl shadow-blue-200 transition transform hover:-translate-y-1 flex items-center justify-center gap-3 w-full sm:w-auto">
                지금 무료로 시뮬레이션 하기
                <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition"></i>
            </a>
        </div>

    </div>

    <div onclick="document.getElementById('next-section').scrollIntoView({ behavior: 'smooth' })"
         class="absolute bottom-2 md:bottom-8 left-0 right-0 mx-auto w-fit flex flex-col items-center animate-bounce z-20 cursor-pointer opacity-60 hover:opacity-100 transition p-2">
        <span class="text-[10px] md:text-xs font-medium text-slate-400 mb-1 md:mb-2 text-center">SCROLL</span>
        <i class="fa-solid fa-chevron-down text-slate-400 text-xl md:text-2xl"></i>
    </div>
</main>

<section id="next-section" class="bg-white py-16 md:py-32 border-t border-slate-100 relative z-20 w-full">
    <div onclick="document.getElementById('top-section').scrollIntoView({ behavior: 'smooth' })"
         class="absolute -top-6 left-0 right-0 mx-auto w-12 h-12 bg-white border border-slate-200 shadow-lg rounded-full flex items-center justify-center cursor-pointer hover:-translate-y-1 transition text-slate-400 hover:text-blue-600 z-30">
        <i class="fa-solid fa-chevron-up text-xl"></i>
    </div>

    <div class="max-w-7xl mx-auto px-6 md:px-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12 text-center md:text-left">
            <div class="p-6 md:p-8 rounded-3xl hover:bg-slate-50 transition duration-300">
                <div class="w-12 h-12 md:w-14 md:h-14 bg-indigo-100 rounded-2xl flex items-center justify-center text-indigo-600 text-xl md:text-2xl mb-4 md:mb-6 mx-auto md:mx-0">
                    <i class="fa-solid fa-database"></i>
                </div>
                <h3 class="text-xl md:text-2xl font-bold mb-2 md:mb-4 text-slate-800">실시간 데이터 분석</h3>
                <p class="text-slate-500 leading-relaxed text-sm md:text-lg break-keep">매일 업데이트되는 지자체 공고문을 RAG 기술로 수집하여 가장 최신의 정보를 제공합니다.</p>
            </div>
            <div class="p-6 md:p-8 rounded-3xl hover:bg-slate-50 transition duration-300">
                <div class="w-12 h-12 md:w-14 md:h-14 bg-emerald-100 rounded-2xl flex items-center justify-center text-emerald-600 text-xl md:text-2xl mb-4 md:mb-6 mx-auto md:mx-0">
                    <i class="fa-solid fa-scale-balanced"></i>
                </div>
                <h3 class="text-xl md:text-2xl font-bold mb-2 md:mb-4 text-slate-800">변경 시나리오 예측</h3>
                <p class="text-slate-500 leading-relaxed text-sm md:text-lg break-keep">"소득 기준이 바뀌면?" 다양한 가정 상황을 LLM이 시뮬레이션하여 결과를 예측합니다.</p>
            </div>
            <div class="p-6 md:p-8 rounded-3xl hover:bg-slate-50 transition duration-300">
                <div class="w-12 h-12 md:w-14 md:h-14 bg-orange-100 rounded-2xl flex items-center justify-center text-orange-600 text-xl md:text-2xl mb-4 md:mb-6 mx-auto md:mx-0">
                    <i class="fa-solid fa-file-contract"></i>
                </div>
                <h3 class="text-xl md:text-2xl font-bold mb-2 md:mb-4 text-slate-800">쉬운 요약 리포트</h3>
                <p class="text-slate-500 leading-relaxed text-sm md:text-lg break-keep">어려운 법률 용어 대신, 누구나 이해하기 쉬운 언어로 핵심 혜택을 요약해 드립니다.</p>
            </div>
        </div>
    </div>
</section>

<div th:replace="HF :: footer"></div>

<script>
    // --- [수정된 부분] 물결 효과 설정값 ---
    // 착시 현상 수준의 아주 미세한 움직임
    const WAVE_CONFIG = {
        amplitude: 0.4,  // 물결 높이를 0.4px로 줄임 (거의 안 움직이는 수준)
        frequency: 0.01, // 물결 간격은 유지
        speed: 0.01      // 속도를 0.01로 줄여 아주 천천히 '숨쉬는' 느낌으로 변경
    };

    const canvas = document.getElementById('textCanvas');
    const ctx = canvas.getContext('2d');

    // 메모리상의 가상 캔버스 (원본 텍스트 보관용)
    let bufferCanvas = document.createElement('canvas');
    let bufferCtx = bufferCanvas.getContext('2d');

    const finalTextContainer = document.getElementById('final-text-container');
    const clickHint = document.getElementById('click-hint-msg');

    let particles = [];
    let isExploded = false;
    let time = 0;
    let animationFrameId;

    // 1. 텍스트 설정 (반응형)
    function getSettings() {
        if (window.innerWidth < 768) {
            return {
                lines: ["남들은 혜택 받는다던데,", "나도 해당될까?", "내 조건이 바뀌어도", "계속 받을 수 있을까?"],
                fontSize: 28, lineHeight: 40, color: "#475569"
            };
        } else {
            return {
                lines: ["남들은 혜택 받는다던데, 나도 해당될까?", "내 조건이 바뀌어도 계속 받을 수 있을까?"],
                fontSize: 48, lineHeight: 70, color: "#334155"
            };
        }
    }

    // 2. 초기화 및 리사이즈 (핵심: 너비 0일 때 방어)
    function resize() {
        const wrapper = document.getElementById('canvas-wrapper');
        if (!wrapper) return;

        const w = wrapper.offsetWidth;
        const h = wrapper.offsetHeight;

        // [안전장치] 너비가 0이면 아직 준비 안 된 것이므로 중단
        if (w === 0 || h === 0) return;

        // 캔버스 크기 맞춤
        canvas.width = w;
        canvas.height = h;
        bufferCanvas.width = w;
        bufferCanvas.height = h;

        // 폭발 전이라면 버퍼에 원본 텍스트 다시 그림
        if (!isExploded) {
            drawTextToBuffer();
        }
    }

    // 3. 버퍼에 텍스트 그리기 (화면엔 안 나옴)
    function drawTextToBuffer() {
        const settings = getSettings();

        bufferCtx.clearRect(0, 0, bufferCanvas.width, bufferCanvas.height);
        bufferCtx.fillStyle = settings.color;
        bufferCtx.font = `bold ${settings.fontSize}px 'Pretendard', sans-serif`;
        bufferCtx.textAlign = "center";
        bufferCtx.textBaseline = "middle";

        const totalHeight = settings.lines.length * settings.lineHeight;
        let startY = (bufferCanvas.height - totalHeight) / 2 + (settings.lineHeight / 2);

        settings.lines.forEach((line, index) => {
            bufferCtx.fillText(line, bufferCanvas.width / 2, startY + (index * settings.lineHeight));
        });
    }

    // 4. 물결 애니메이션 (실제 화면에 그리기)
    function renderWave() {
        if (isExploded) return;

        // [안전장치] 캔버스 크기가 0이면 그리지 않고 다음 프레임 대기
        if (canvas.width === 0) {
            requestAnimationFrame(renderWave);
            return;
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        time += WAVE_CONFIG.speed;

        // 최적화: 2px 단위로 잘라서 옮기기
        const slice = 2;

        for (let x = 0; x < canvas.width; x += slice) {
            // sin 함수로 Y축 흔들림 계산
            const yOffset = Math.sin(x * WAVE_CONFIG.frequency + time) * WAVE_CONFIG.amplitude;

            // 버퍼(원본)에서 잘라와서 -> 화면에 yOffset 만큼 옮겨 그림
            ctx.drawImage(
                bufferCanvas,
                x, 0, slice, canvas.height,     // 원본 위치
                x, yOffset, slice, canvas.height // 화면 위치
            );
        }

        animationFrameId = requestAnimationFrame(renderWave);
    }

    // 5. 안전한 앱 시작 (흰 화면 방지 로직)
    function initApp() {
        const wrapper = document.getElementById('canvas-wrapper');

        // 아직 화면이 안 떴거나, 너비가 0이면 계속 대기
        if (!wrapper || wrapper.offsetWidth === 0) {
            requestAnimationFrame(initApp);
            return;
        }

        // 너비가 잡히면 그때 시작!
        resize();
        renderWave();
    }

    // --- 파티클 폭발 효과 ---
    function createParticles() {
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        particles = [];
        const step = 2; // 입자 밀도

        for (let y = 0; y < canvas.height; y += step) {
            for (let x = 0; x < canvas.width; x += step) {
                const index = (y * canvas.width + x) * 4;
                if (data[index + 3] > 0) {
                    particles.push({
                        x: x, y: y,
                        color: `rgba(${data[index]}, ${data[index+1]}, ${data[index+2]}, ${data[index+3]})`,
                        vx: (Math.random() - 0.5) * 4,
                        vy: (Math.random() - 0.5) * 4,
                        life: Math.random() * 30 + 50,
                        size: Math.random() * 2 + 1
                    });
                }
            }
        }
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        animateParticles();
    }

    function animateParticles() {
        if (particles.length === 0) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < particles.length; i++) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy;
            p.vx *= 0.95; p.vy *= 0.95; p.vy -= 0.1;
            p.life--;
            if (p.life > 0) {
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            }
        }
        requestAnimationFrame(animateParticles);
    }

    window.explodeText = function() {
        if (!isExploded) {
            isExploded = true;
            cancelAnimationFrame(animationFrameId); // 물결 멈춤
            if(clickHint) clickHint.style.display = 'none';
            createParticles(); // 폭발 시작
            setTimeout(() => {
                finalTextContainer.classList.add('visible');
            }, 800);
        }
    };

    window.addEventListener('resize', resize);

    // [시작점] 앱 초기화 시작
    initApp();

    // 폰트 로딩 완료 시 혹시 모르니 재조정
    document.fonts.ready.then(resize);

</script>

</body>
</html>