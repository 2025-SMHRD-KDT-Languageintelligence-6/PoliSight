<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<div th:fragment="chatbot">

    <th:block th:if="${session.loginMember != null}">

        <link rel="stylesheet" th:href="@{/css/chatbot.css}">

        <div id="chatbot-container">
            <button id="chatbot-toggle-btn">ğŸ’¬</button>

            <div id="chatbot-window">
                <div class="chatbot-header">
                    <span>AI ë„ìš°ë¯¸</span>
                    <button id="chatbot-close-btn">&times;</button>
                </div>

                <div id="chatbot-messages">
                    <div class="message bot-message">ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
                </div>

                <div class="chatbot-input-area">
                    <input type="text" id="chatbot-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...">
                    <button id="chatbot-send-btn">ì „ì†¡</button>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const toggleBtn = document.getElementById('chatbot-toggle-btn');
                const closeBtn = document.getElementById('chatbot-close-btn');
                const chatWindow = document.getElementById('chatbot-window');
                const sendBtn = document.getElementById('chatbot-send-btn');
                const input = document.getElementById('chatbot-input');
                const messages = document.getElementById('chatbot-messages');

                // í† ê¸€ (ì—´ê¸°/ë‹«ê¸°)
                toggleBtn.addEventListener('click', () => {
                    chatWindow.classList.toggle('visible');
                    if(chatWindow.classList.contains('visible')) input.focus();
                });

                // ë‹«ê¸° ë²„íŠ¼
                closeBtn.addEventListener('click', () => {
                    chatWindow.classList.remove('visible');
                });

                // ë©”ì‹œì§€ ì „ì†¡ ê¸°ëŠ¥
                function sendMessage() {
                    const text = input.value.trim();
                    if (!text) return;

                    addMessage(text, 'user-message');
                    input.value = '';

                    // (ëª¨ì˜) ì„œë²„ ì‘ë‹µ
                    setTimeout(() => {
                        addMessage("ì„œë²„ ì‘ë‹µ: " + text, 'bot-message');
                    }, 500);
                }

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
                sendBtn.addEventListener('click', sendMessage);
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendMessage();
                });

                function addMessage(text, type) {
                    const div = document.createElement('div');
                    div.classList.add('message', type);
                    div.textContent = text;
                    messages.appendChild(div);
                    messages.scrollTop = messages.scrollHeight;
                }
            });
        </script>

    </th:block> </div>
</html>